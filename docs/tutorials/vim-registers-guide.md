# Vim 寄存器完全指南

## 什么是寄存器？

寄存器（Register）是 Vim 中用于临时存储文本的"剪贴板"。与系统剪贴板不同，Vim 提供了**多个**寄存器，让你可以同时保存多段文本，并在需要时选择性地使用它们。

## 为什么需要寄存器？

想象你在编辑代码时需要：
1. 删除一段代码（但可能稍后还要用）
2. 复制一个变量名
3. 复制一个函数名
4. 粘贴之前删除的代码

使用单一剪贴板，后面的操作会覆盖前面的内容。而 Vim 寄存器让你可以同时保存所有这些内容！

---

## 寄存器类型

### 1. 无名寄存器 `"`（默认）

**最常用**，所有删除、复制操作默认使用这个寄存器。

```vim
" 删除一行（存到无名寄存器）
dd

" 复制一行（存到无名寄存器）
yy

" 粘贴无名寄存器的内容
p
```

**特点**：
- 每次删除/复制都会覆盖之前的内容
- `p` 命令默认使用这个寄存器

---

### 2. 数字寄存器 `0-9`

**自动存储删除历史**，类似"回收站"。

```vim
" 0 号寄存器：存储最后一次复制（yank）的内容
" 即使后面执行了删除，0 号寄存器仍然保留复制的内容

" 1-9 号寄存器：存储最近 9 次删除的内容
" 1 是最新，9 是最旧
```

**使用示例**：
```vim
" 复制重要内容
yy

" 不小心删除了其他内容
dd
dd

" 使用 0 号寄存器找回最初复制的内容
"0p
```

---

### 3. 命名寄存器 `a-z`

**用户自定义寄存器**，可以显式指定存储位置。

```vim
" 复制到寄存器 a
"ayy

" 从寄存器 a 粘贴
"ap

" 删除到寄存器 b
"bdd

" 从寄存器 b 粘贴
"bp
```

**大写 vs 小写**：
```vim
" 小写（a）：覆盖寄存器内容
"ayy    " 寄存器 a = 当前行

" 大写（A）：追加到寄存器内容
"Ayy    " 寄存器 a = 之前内容 + 当前行
```

---

### 4. 只读寄存器

**特殊用途**，内容由 Vim 自动设置。

| 寄存器 | 内容 | 示例 |
|--------|------|------|
| `.` | 最后插入的文本 | `".p` 粘贴最后输入的内容 |
| `%` | 当前文件名 | `"%p` 粘贴文件名 |
| `:` | 最后执行的命令 | `":p` 粘贴最后命令 |
| `#` | 交替文件名 | 上一个编辑的文件 |

---

### 5. 表达式寄存器 `=`

**计算表达式**，非常强大！

```vim
" 在插入模式下计算数学表达式
Ctrl+r =
2+2
" 结果：4

" 在普通模式下
"=2+2<Enter>p
" 粘贴计算结果 4

" 使用变量
"=$HOME<Enter>p
" 粘贴环境变量值
```

---

### 6. 选择和拖拽寄存器 `*` 和 `+`

**系统剪贴板交互**。

```vim
" 复制到系统剪贴板（Linux）
"*yy

" 从系统剪贴板粘贴
"*p

" + 寄存器通常也是系统剪贴板
"+yy
"+p
```

**注意**：
- `*` 是主选区（鼠标选中）
- `+` 是剪贴板（Ctrl+C/Ctrl+V）
- 在 Windows 和 macOS 上通常相同

---

### 7. 黑洞寄存器 `_`

**彻底删除**，不保存到任何寄存器。

```vim
" 删除但不影响任何寄存器（包括无名寄存器）
"_dd

" 用途：删除不需要的内容，保留剪贴板原有内容
```

---

### 8. 搜索寄存器 `/`

**存储最后的搜索模式**。

```vim
" 搜索某个词
/hello

" 粘贴搜索模式
"/p
" 结果：hello

" 在替换命令中使用
:%s/<Ctrl+r />/world/g
" 等价于 :%s/hello/world/g
```

---

## 常用操作速查表

### 复制（Yank）到指定寄存器

| 命令 | 说明 |
|------|------|
| `"ayy` | 复制当前行到寄存器 a |
| `"ayw` | 复制当前单词到寄存器 a |
| `"a3yy` | 复制 3 行到寄存器 a |
| `"Ayy` | 追加当前行到寄存器 a |

### 删除到指定寄存器

| 命令 | 说明 |
|------|------|
| `"add` | 删除当前行到寄存器 a |
| `"adw` | 删除当前单词到寄存器 a |
| `"ad$` | 删除到行尾到寄存器 a |
| `"Add` | 追加删除内容到寄存器 a |

### 粘贴指定寄存器

| 命令 | 说明 |
|------|------|
| `"ap` | 在光标后粘贴寄存器 a |
| `"aP` | 在光标前粘贴寄存器 a |
| `"0p` | 粘贴最后一次复制的内容 |
| `"1p` | 粘贴最后一次删除的内容 |
| `"2p` | 粘贴倒数第二次删除的内容 |

---

## 实用技巧

### 技巧 1：多重剪贴板

```vim
" 复制函数名到 a
"ayiw

" 复制参数到 b
"byiw

" 复制函数体到 c
"cV{}

" 在需要的地方分别粘贴
"ap    " 粘贴函数名
"bp    " 粘贴参数
"cp    " 粘贴函数体
```

### 技巧 2：收集代码片段

```vim
" 初始化寄存器 a 为空（通过复制空行）
0"ay$

" 收集多个有用的代码行
"Add    " 追加删除的行到 a
"Add    " 继续追加
"Add    " 继续追加

" 粘贴所有收集的内容
"ap
```

### 技巧 3：交换两行

```vim
" 复制第一行到寄存器 a
dd
" 复制第二行到寄存器 b
dd
" 粘贴第一行
"ap
" 粘贴第二行
"bp
```

### 技巧 4：在替换中使用寄存器

```vim
" 先复制要替换的内容
"ayiw    " 复制当前单词到 a

" 然后使用在替换中
:%s/old/<Ctrl+r a>/g
" Ctrl+r a 会插入寄存器 a 的内容
```

### 技巧 5：查看寄存器内容

```vim
" 显示所有寄存器
:registers
" 或简写
:reg

" 显示特定寄存器
:reg a b c
```

---

## AIVim 寄存器支持状态

| 寄存器类型 | 支持状态 | 说明 |
|------------|----------|------|
| 无名寄存器 `"` | ✅ | 完全支持 |
| 数字寄存器 `0-9` | ✅ | 完全支持 |
| 命名寄存器 `a-z` | ⚠️ | 基础支持（简化版） |
| 只读寄存器 `.%:#` | ❌ | 计划中 |
| 表达式寄存器 `=` | ❌ | 计划中 |
| 系统剪贴板 `*+` | ❌ | 计划中 |
| 黑洞寄存器 `_` | ❌ | 计划中 |
| 搜索寄存器 `/` | ✅ | 完全支持 |

---

## 练习

### 练习 1：多重复制

```
1. 打开一个文件，包含多行不同内容
2. 用 "ayy 复制第一行到寄存器 a
3. 用 "byy 复制第二行到寄存器 b
4. 用 "cyy 复制第三行到寄存器 c
5. 分别用 "ap、"bp、"cp 粘贴，观察顺序
```

### 练习 2：恢复误删

```
1. 复制一行重要内容（yy）
2. 删除几行其他内容（dd 多次）
3. 用 "0p 粘贴最初复制的内容
4. 用 "1p、"2p 查看删除历史
```

### 练习 3：收集模式

```
1. 用 "_dd 清空寄存器 a（通过删除空行）
2. 找到几行需要的代码
3. 用 "Add 追加每行到寄存器 a
4. 用 "ap 粘贴所有收集的代码
```

---

## 总结

寄存器是 Vim 最强大的功能之一，掌握它可以极大地提高编辑效率：

- **无名寄存器**：日常使用，简单快捷
- **数字寄存器**：自动历史，防止误删
- **命名寄存器**：主动管理，多重剪贴板
- **特殊寄存器**：高级功能，提升效率

**记住**：在 Vim 中，删除不是删除，而是"剪切"到寄存器！

---

**文档版本**：1.0  
**适用版本**：AIVim 0.1.0+  
**最后更新**：2026-02-20
