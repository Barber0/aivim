# Aivim 多缓冲区管理教程

## 什么是缓冲区？

缓冲区（Buffer）是 Vim 中用于存储文件内容的内存区域。在 Aivim 中，您可以同时打开多个文件，每个文件对应一个缓冲区，方便在多文件之间快速切换和编辑。

## 基础概念

- **缓冲区**：内存中的文件内容
- **当前缓冲区**：您正在编辑的缓冲区
- **缓冲区列表**：所有打开的缓冲区

## 创建缓冲区

### 1. 打开文件

```vim
:e filename.txt      " 打开文件（创建新缓冲区）
:edit filename.txt   " 同上
```

### 2. 创建空缓冲区

```vim
:new                 " 创建新的空缓冲区
```

### 3. 启动时打开多个文件

```bash
./aivim file1.txt file2.txt file3.txt
```

## 查看缓冲区列表

```vim
:ls                  " 显示缓冲区列表
:buffers             " 同上
```

显示效果：
```
┌──────────────────────────────────────────┐
│ Buffer List                              │
│                                          │
│   缓冲区列表                             │
│                                          │
│   ID       文件名                        │
│  ─────────────────────────────────────── │
│   0   %    file1.txt          ← 当前缓冲区 │
│   1        file2.txt                     │
│   2   +    [未命名]           ← 有未保存修改 │
│                                          │
│   提示: 按 q 或 Esc 关闭, :b <id> 切换   │
└──────────────────────────────────────────┘
```

**状态标记说明**：
- `%` - 当前正在编辑的缓冲区
- `+` - 有未保存的修改

## 切换缓冲区

### 直接切换到指定缓冲区

```vim
:b 1                 " 切换到缓冲区 1
:buffer 2            " 切换到缓冲区 2
:b 0                 " 切换到缓冲区 0
```

### 切换到下一个缓冲区

```vim
:bn                  " 切换到下一个缓冲区
:bnext               " 同上
:next                " 同上
```

### 切换到上一个缓冲区

```vim
:bp                  " 切换到上一个缓冲区
:bprev               " 同上
:bprevious           " 同上
:prev                " 同上
```

**注意**：`:bn` 和 `:bp` 会循环切换，到最后一个后会回到第一个。

## 删除缓冲区

### 删除当前缓冲区

```vim
:bd                  " 删除当前缓冲区（如果有未保存修改会失败）
:bdelete             " 同上
```

### 强制删除当前缓冲区

```vim
:bd!                 " 强制删除当前缓冲区（忽略未保存修改）
:bdelete!            " 同上
```

### 删除指定缓冲区

```vim
:bd 2                " 删除缓冲区 2
:bd! 2               " 强制删除缓冲区 2
```

**注意**：
- 删除当前缓冲区后，会自动切换到其他缓冲区
- 如果删除的是唯一的缓冲区，会自动创建一个新的空缓冲区
- 有未保存修改的缓冲区需要使用 `:bd!` 强制删除

## 实用工作流程

### 场景 1：同时编辑多个文件

```vim
" 1. 打开第一个文件
:e config.txt

" 2. 创建新缓冲区编辑第二个文件
:new
" 编辑内容...

" 3. 打开第三个文件
:e readme.md

" 4. 查看所有缓冲区
:ls

" 5. 在缓冲区间切换
:b 0                 " 回到 config.txt
:bn                  " 下一个缓冲区
:bp                  " 上一个缓冲区
```

### 场景 2：对比两个文件

```vim
" 1. 打开两个文件
:e file1.txt
:e file2.txt

" 2. 在 :ls 面板中查看两个文件
:ls

" 3. 快速切换对比
:b 0
" 查看 file1.txt 的内容...

:b 1
" 查看 file2.txt 的内容...
```

### 场景 3：清理不需要的缓冲区

```vim
" 1. 查看所有缓冲区
:ls

" 2. 删除不需要的缓冲区
:bd 3                " 删除缓冲区 3
:bd 5                " 删除缓冲区 5

" 3. 确认清理结果
:ls
```

## 快捷键参考

| 命令 | 功能 |
|------|------|
| `:e <file>` | 打开文件 |
| `:new` | 创建空缓冲区 |
| `:ls` / `:buffers` | 显示缓冲区列表 |
| `:b <id>` | 切换到指定缓冲区 |
| `:bn` / `:bnext` | 切换到下一个缓冲区 |
| `:bp` / `:bprev` | 切换到上一个缓冲区 |
| `:bd` | 删除当前缓冲区 |
| `:bd!` | 强制删除当前缓冲区 |
| `:bd <id>` | 删除指定缓冲区 |

## 面板操作

当显示 `:ls` 或 `:registers` 面板时：

| 按键 | 功能 |
|------|------|
| `q` | 关闭面板 |
| `Esc` | 关闭面板 |
| 其他任意键 | 关闭面板并继续处理按键 |

## 最佳实践

1. **及时清理**：不用的缓冲区及时用 `:bd` 删除，保持列表整洁
2. **保存修改**：切换缓冲区前记得保存修改（`:w`）
3. **使用列表**：养成使用 `:ls` 查看缓冲区的习惯
4. **循环导航**：`:bn` 和 `:bp` 可以循环使用，快速在文件间跳转

## 常见问题

### Q: 为什么 `:bn` 提示"没有其他缓冲区"？
A: 只有一个缓冲区时无法切换，需要先 `:new` 或 `:e` 创建更多缓冲区。

### Q: 删除缓冲区后文件会被删除吗？
A: 不会，`:bd` 只是关闭内存中的缓冲区，不影响磁盘上的文件。

### Q: 如何保存所有缓冲区的修改？
A: 目前需要逐个缓冲区保存（`:w`），未来会添加 `:wa`（write all）命令。

### Q: 缓冲区 ID 是固定的吗？
A: 不是，删除缓冲区后 ID 不会重用，新缓冲区的 ID 会递增。

## 下一步

掌握了多缓冲区管理后，您可以：
- 同时编辑多个相关文件
- 在头文件和源文件间快速切换
- 参考文档同时编辑代码
- 更高效地进行多文件项目管理

---

**提示**：多缓冲区是 Vim 提高工作效率的重要功能，建议多加练习，形成肌肉记忆！
